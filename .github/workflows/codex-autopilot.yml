name: üß† Codex Autopilot

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 */6 * * *"
  workflow_dispatch:

jobs:
  codex-autonomous:
    runs-on: ubuntu-latest

    steps:
      - name: üõéÔ∏è Checkout c√≥digo
        uses: actions/checkout@v3

      - name: üß† Analisar reposit√≥rio com Codex
        uses: openai-labs/codex-analyze-action@v1
        with:
          api-key: ${{ secrets.CODEX_API_KEY }}
          mode: "auto"
          objectives: |
            1. Corrigir SEO (meta tags, robots.txt, duplicatas)
            2. Remover arquivos mortos (ex: public/index.html duplicado, BiotipoCalculator n√£o usado)
            3. Substituir SalesBot.jsx por Alquimista com WhatsApp
            4. Implementar ProductGrid com produtos reais Castor
            5. Gerar README.md atualizado e LICENSE (MIT)
            6. Committar melhorias no branch main

      - name: üìù Aplicar melhorias autom√°ticas
        run: |
          git config --global user.name "codex-bot"
          git config --global user.email "codex-bot@users.noreply.github.com"
          git add .
          git commit -m "ü§ñ Codex Autopilot: SEO + Alquimista + limpeza duplicatas" || echo "Nenhuma mudan√ßa detectada"
          git push origin main

      - name: üöÄ Deploy autom√°tico no Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: .
          prod: true
